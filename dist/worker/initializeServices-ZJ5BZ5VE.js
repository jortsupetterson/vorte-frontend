import{a as s}from"./chunk-EI7MMDWY.js";var p={sign_in:{init:s(async(t,e,n,a)=>await t.AUTHN_SERVICE.signInInitialization(e,n,a),"init"),callback:s(async(t,e,n,a,i)=>await t.AUTHN_SERVICE.signInCallback(e,n,a,await i.get("code"),await i.get("state")),"callback")},sign_up:{init:s(async(t,e,n,a,i,r)=>await t.AUTHN_SERVICE.signUpInitialization(e,await r),"init"),callback:s(async(t,e,n,a,i,r)=>await t.AUTHN_SERVICE.signUpCallback(e,n,await r),"callback")}};async function S(t,e,n,a,i,r){if(a[1]==="authn"){if(a[3]==="init"){let[l,u]=await Promise.all([i.get("token"),t.TURNSTILE_SECRET.get()]);if(!l||!u)return new Response(null,{status:400});let o=new URLSearchParams;if(o.append("secret",u),o.append("response",l),!await(await fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o})).json())return new Response("LOL",{status:400,headers:{"Set-Cookie":'AUTHN_CHALLENGE=""; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=0;'}})}let c=await(await p[a[2]][a[3]])(t,e,n,a,i,r);return new Response(c.body,{status:c.status,headers:c.headers})}}s(S,"initializeServices");export{S as initializeServices};
