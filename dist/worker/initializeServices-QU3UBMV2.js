import{a as i}from"./chunk-F54ZTCKN.js";var p={sign_in:{init:i(async(e,a,n,t)=>await e.AUTHN_SERVICE.signInInitialization(a,n,t),"init"),callback:i(async(e,a,n,t,s)=>await e.AUTHN_SERVICE.signInCallback(a,n,t,await s.get("code"),await s.get("state")),"callback")},sign_up:{init:i(async(e,a,n,t)=>await e.AUTHN_SERVICE.signUpInitialization(a,n,t),"init"),callback:i(async(e,a,n,t)=>await e.AUTHN_SERVICE.signUpCallback(a,n,t),"callback")}};async function h(e,a,n,t,s){if(t[1]==="authn"){if(t[3]==="init"){let[c,l]=await Promise.all([s.get("token"),e.TURNSTILE_SECRET.get()]);if(!c||!l)return new Response(null,{status:400});let o=new URLSearchParams;if(o.append("secret",l),o.append("response",c),!await(await fetch("https://challenges.cloudflare.com/turnstile/v0/siteverify",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o})).json())return new Response(null,{status:400,headers:{"Set-Cookie":'AUTHN_CHALLENGE=""; HttpOnly; Secure; SameSite=Strict; Path=/; Max-Age=0;'}})}let r=await(await p[t[2]][t[3]])(e,a,n,t,s);return new Response(r.body,{status:r.status,headers:r.headers})}}i(h,"initializeServices");export{h as initializeServices};
