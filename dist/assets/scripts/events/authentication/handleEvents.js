var F=Object.defineProperty;var r=(t,e)=>F(t,"name",{value:e,configurable:!0});async function g(t=100,e=5e3){let n=performance.now(),i;do{if(i=globalThis.turnstile,i)return i;if(performance.now()-n>e)throw new Error("Turnstile ei latautunut ajoissa");await new Promise(o=>setTimeout(o,t))}while(!i)}r(g,"waitForTurnstile");function T(t,e="en"){let{id:n,value:i,successMessage:o,errorMessage:a}=t;if(typeof i!="string")throw new TypeError("Name must be a string");let s=i.normalize("NFC").trim(),l=C.test(s);return{id:n,status:l,message:l?o||k.valid[e]:a||k.invalid[e]}}r(T,"validateProperName");var C=/^(?=.{1,64}$)(?:[A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)(?:[-\u2010\u2011'â€™][A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)?$/,k={valid:{fi:"Nimi on kelvollinen.",sv:"Namnet \xE4r giltigt.",en:"The name is valid."},invalid:{fi:"Nimen tulee alkaa isolla kirjaimella ja olla muodossa 'Esimerkki' tai 'Esimerkki-Esimerkki'.",sv:"Namnet m\xE5ste b\xF6rja med en stor bokstav och vara i formen 'Exempel' eller 'Exempel-Exempel'.",en:"The name must start with a capital letter and be in the form 'Example' or 'Example-Example'."}};var M=/^(?=.{1,254}$)(?=^[^@]{1,64}@)(?:[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+(?:\.[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+)*)@(?:[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?\.)+(?:[A-Za-z]{2,63}|xn--[A-Za-z0-9-]{2,59})$/,E={valid:{fi:"S\xE4hk\xF6postiosoite on kelvollinen.",sv:"E-postadressen \xE4r giltig.",en:"The email address is valid."},invalid:{fi:"S\xE4hk\xF6postiosoitteen on oltava muodossa 'user@example.com'.",sv:"E-postadressen m\xE5ste vara i formen 'user@example.com'.",en:"The email address must be in the form 'user@example.com'."}};function I(t,e="en"){let{id:n,value:i,successMessage:o,errorMessage:a}=t;if(typeof i!="string")throw new TypeError("Email address must be a string");let s=i.trim(),l=M.test(s);return{id:n,status:l,message:l?o||E.valid[e]:a||E.invalid[e]}}r(I,"validateEmailAddress");var N=/^\+[1-9]\d{2}\d{9}$/,v={valid:{fi:"Puhelinnumero on kelvollinen.",sv:"Telefonnumret \xE4r giltigt.",en:"The phone number is valid."},invalid:{fi:"Puhelinnumeron on oltava muodossa '+123123456789' (kolme numeroa maatunnus ja yhdeks\xE4n numeroa).",sv:"Telefonnumret m\xE5ste vara i formen '+123123456789' (tre siffror landskod och nio siffror).",en:"The phone number must be in the format '+123123456789' (three-digit country code and nine digits)."}};function D(t,e="en"){let{id:n,value:i,successMessage:o,errorMessage:a}=t;if(typeof i!="string")throw new TypeError("Phone number must be a string");if(i.length!==13||i.charCodeAt(0)!==43)return{id:n,status:!1,message:a||v.invalid[e]};let s=N.test(i);return{id:n,status:s,message:s?o||v.valid[e]:a||v.invalid[e]}}r(D,"validatePhoneNumber");var y={valid:{fi:"Valintaruutu on valittu.",sv:"Kryssrutan \xE4r markerad.",en:"The checkbox is checked."},invalid:{fi:"T\xE4m\xE4 valintaruutu on pakollinen ja sen on oltava valittuna.",sv:"Den h\xE4r kryssrutan \xE4r obligatorisk och m\xE5ste vara markerad.",en:"This checkbox is required and must be checked."}};function j(t,e="en"){let{id:n,required:i,value:o,successMessage:a,errorMessage:s}=t;if(typeof o!="boolean")throw new TypeError("Checkbox value must be a boolean");let l=!0;return i===!0&&o===!1&&(l=!1),{id:n,status:l,message:l?a||y.valid[e]:s||y.invalid[e]}}r(j,"validateCheckboxInput");function L(t,e={}){let{trim:n=!0,collapseWhitespace:i=!0,stripControls:o=!0,maxLen:a=4096}=e,s=String(t??"");return n&&(s=s.trim()),o&&(s=s.replace(/[\u0000-\u001F\u007F]/g,"")),i&&(s=s.replace(/\s+/g," ")),a&&s.length>a&&(s=s.slice(0,a)),s}r(L,"sanitizeString");function _(t){return String(t??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}r(_,"escapeHTML");var B={properName:T,emailAddress:I,phoneNumber:D,checkboxInput:j,string:L,html:_};async function b(t,e="en"){if(!Array.isArray(t))throw new TypeError("fields must be an array of rule objects");let n=[];for(let i of t){let o=B[i.type],a=o(i,e);n.push({id:a.id,status:a.status,message:a.message})}return n}r(b,"validate");async function x(t,e){return b([{id:"firstname",type:"properName",required:!0,value:t.firstname,errorMessage:{fi:"Etunimi on pakollinen",sv:"F\xF6rnamn kr\xE4vs",en:"First name is required"}[e]},{id:"lastname",type:"properName",required:!0,value:t.lastname,errorMessage:{fi:"Sukunimi on pakollinen",sv:"Efternamn kr\xE4vs",en:"Last name is required"}[e]},{id:"email",type:"emailAddress",required:!0,value:t.email,errorMessage:{fi:"S\xE4hk\xF6posti on pakollinen",sv:"E-post kr\xE4vs",en:"Email is required"}[e]},{id:"terms-acceptance",type:"checkboxInput",required:!0,value:t.termsAcceptance,errorMessage:{fi:"Hyv\xE4ksy ehdot",sv:"Acceptera villkoren",en:"Accept terms"}[e]},{id:"contact-permission",type:"checkboxInput",required:!0,value:t.contactPermission,errorMessage:{fi:"Yhteydenotto\u2011lupa on pakollinen",sv:"Kontakt\u2011tillst\xE5nd kr\xE4vs",en:"Contact permission is required"}[e]}],e)}r(x,"validateSignUpForm");function w(t,e,n,i){return new Promise(async o=>{let a=document.createElement("dialog");a.innerHTML=`<div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Pieni hetki",sv:"En liten stund",en:"Just a second"}[e]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`,document.body.appendChild(a),a.show();try{n.disabled=!0;let s=await fetch(`/services/authn/sign_up/init?token=${i}`,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)});if(s.status===202){let l=`<strong>${t.email}</strong>`;a.innerHTML=`<h2>${{fi:"Vahvista s\xE4hk\xF6postiosoitteesi",sv:"Bekr\xE4fta din e-postadress",en:"Confirm your email address"}[e]}</h2><div class="row transparent" id="code-input"><input class="digit" type="text" inputmode="numeric" autocomplete="one-time-code" pattern="\\d" maxlength="8"></div><p>${{fi:`Sy\xF6t\xE4 8-numeroinen koodi, jonka l\xE4hetimme osoitteeseen "${l}" osoitteesta "DoNotReply@mail.vorte.app"`,sv:`Ange den 8-siffriga koden som vi skickade till "${l}" fr\xE5n adressen "DoNotReply@mail.vorte.app"`,en:`Enter the 8-digit code we sent to "${l}" from "DoNotReply@mail.vorte.app"`}[e]}</p><button id="send-confirmation" class="action" title="${{fi:"L\xE4het\xE4 koodi palvelimelle tarkistettavaksi ja kirjaudu sis\xE4\xE4n",sv:"Skicka koden till servern f\xF6r kontroll och logga in",en:"Send the code to the server for verification and sign in"}[e]}" > ${{fi:"vahvista k\xE4ytt\xE4j\xE4",sv:"bekr\xE4fta anv\xE4ndare",en:"verify account"}[e]} </button><a hreflang="${e}" id="sign_up" href="${{fi:"/fi/luo-k\xE4ytt\xE4j\xE4tili",sv:"/sv/skapa-konto",en:"/en/create-an-account"}[e]}" title="${{fi:"Yrit\xE4 l\xE4hett\xE4\xE4 lomake uudelleen",sv:"F\xF6rs\xF6k skicka formul\xE4ret igen",en:"Try resubmitting the form"}[e]}"><h5> ${{fi:"Etk\xF6 saanut s\xE4hk\xF6postia? L\xE4het\xE4 lomake uudelleen.",sv:"Fick du inte e-post? Skicka formul\xE4ret igen.",en:"Didn't receive the email? Resubmit the form."}[e]} </h5></a>`,o()}else throw new Error(s)}catch(s){a.textContent={fi:'Jokin meni pieleen. Jos ongelma jatkuu, ota yhteys Vorten tukeen. "support@vorte.app"',sv:'N\xE5got gick fel. Kontakta Vortes support om problemet kvarst\xE5r. "support@vorte.app"',en:'Something went wrong. If the problem persists, please contact Vorte support. "support@vorte.app"'}[e],n.disabled=!1,console.log(s)}})}r(w,"initDialog");async function A(t){let e=document.documentElement.lang||"en",n=document.getElementById("sign-up-btn");n&&n.addEventListener("click",async i=>{i.preventDefault();let o="";typeof turnstile<"u"&&t&&(o=turnstile.getResponse(t));let a={firstname:document.getElementById("firstname").value,lastname:document.getElementById("lastname").value,email:document.getElementById("email").value,termsAcceptance:document.getElementById("terms-acceptance").checked,contactPermission:document.getElementById("contact-permission").checked,newsletterSubscription:document.getElementById("newsletter-subscription").checked};["firstname","lastname","email","terms-acceptance","contact-permission"].forEach(u=>{let d=document.getElementById(`${u}-feedback`);d&&(d.textContent="")});let s=await x(a,e),l=!0;for(let{id:u,status:d,message:c}of s)if(!d){let m=document.getElementById(`${u}-feedback`);m&&(m.textContent=c),l=!1}if(!l)return;await w(a,e,n,o),document.getElementById("send-confirmation").addEventListener("click",async()=>{let u=JSON.stringify({code:document.querySelector("input.digit").value,form:a});try{let d=document.body.querySelector("dialog");d.innerHTML=` <div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Luodaan tili\xE4",sv:"Skapar ditt konto",en:"Creating your account"}[e]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;let c=await fetch("/services/authn/sign_up/callback",{method:"post",headers:{"content-type":"application/json"},body:u}),m=await c.text();console.log(m),console.log(m.status);let p=new Set([201,409,400]).has(c.status)?c.status:400;p===201&&(cookies.HAS_ACCOUNT="true"),await new Promise(f=>{document.getElementById("loader-text").textContent={201:{fi:"Tilin luonti onnistui!",sv:"Kontot har skapats!",en:"Account created successfully!"},409:{fi:"T\xE4ll\xE4 s\xE4hk\xF6postiosoitteella on jo tili",sv:"Det finns redan ett konto med den h\xE4r e-postadressen",en:"An account with this email address already exists"},400:{fi:"Antamasi koodi oli v\xE4\xE4rin tai vanhentunut",sv:"Koden du angav var felaktig eller har g\xE5tt ut",en:"The code you entered was incorrect or has expired"}}[p][e];let h=document.getElementById("loader-animation");h.classList.add("ready"),h.classList.add({201:"success",409:"error",400:"error"}[p]),d.insertAdjacentHTML("beforeend",{201:`<a class="action" id="install" hreflang="${e}" href="https://why.vorte.app${{fi:"/fi/asenna",sv:"/sv/installera",en:"/en/install"}[e]}" >${{fi:" lis\xE4\xE4 laitteesi aloitusn\xE4yt\xF6lle",sv:" l\xE4gg till p\xE5 din enhets startsk\xE4rm",en:" add to your device's home screen"}[e]}</a><a class="action" id="dashboard" href="https://vorte.app${{fi:"/fi/ohjauspaneeli",sv:"/sv/instrumentpanel",en:"/en/dashboard"}[e]}" hreflang="${e}"> ${{fi:" k\xE4yt\xE4n mielummin selaimessa",sv:" jag f\xF6redrar att anv\xE4nda webbl\xE4saren",en:" I prefer to use it in the browser"}[e]} </a>`,409:`<a class="action" id="sign_in" href="${{fi:"/fi/kirjautuminen",sv:"/sv/inloggning",en:"/en/login"}[e]}" hreflang="${e}"> ${{fi:" siirry kirjautumiseen",sv:" g\xE5 till inloggning",en:" go to login"}[e]} </a>`,400:`<a class="action" id="sign_up" href="${{fi:"/fi/luo-k\xE4ytt\xE4j\xE4tili",sv:"/sv/skapa-konto",en:"/en/create-an-account"}[e]}" hreflang="${e}"> ${{fi:" yrit\xE4 uudelleen",sv:" f\xF6rs\xF6k igen",en:" try again"}[e]} </a>`}[p]),f()}),document.getElementById("install").addEventListener("click",f=>{f.preventDefault(),window.pwaInstall.prompt(e)})}catch(d){console.error(d)}})})}r(A,"signUpHandler");var P=new Set(["apple","google","microsoft"]);async function S(t){let e=document.documentElement.lang||"en";document.addEventListener("click",async n=>{let i=n.target.closest("button");if(!i)return;let o="";typeof turnstile<"u"&&t&&(o=turnstile.getResponse(t));let a=i.getAttribute("data-method"),s=i.getAttribute("data-provider"),l=`/services/authn/sign_in/init/${a}/${s}?token=${o}`;if(a==="social"&&P.has(s)){window.location.href=l;return}})}r(S,"signInHandler");async function $(){let t=document.body.querySelectorAll("button");t.forEach(n=>{n.disabled=!0}),await g();let e;e=turnstile.render("#turnstile-container",{sitekey:"0x4AAAAAABfpGcyoBCK_N8CO",theme:document.documentElement.getAttribute("data-theme"),size:"flexible",callback(){t.forEach(n=>{n.disabled=!1})},"expired-callback"(){e&&turnstile.reset(e),t.forEach(n=>{n.disabled=!0})}}),document.documentElement.getAttribute("data-view")==="sign_up"&&A(e),document.documentElement.getAttribute("data-view")==="sign_in"&&S(e,t)}r($,"handleEvents");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",$):$();export{$ as handleEvents};
