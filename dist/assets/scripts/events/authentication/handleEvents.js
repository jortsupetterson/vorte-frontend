import{a as r}from"../../chunk-EI7MMDWY.js";function F(i,e="en"){let{id:t,value:n,successMessage:s,errorMessage:o}=i;if(typeof n!="string")throw new TypeError("Name must be a string");let a=n.normalize("NFC").trim(),l=T.test(a);return{id:t,status:l,message:l?s||k.valid[e]:o||k.invalid[e]}}r(F,"validateProperName");var T=/^(?=.{1,64}$)(?:[A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)(?:[-\u2010\u2011'â€™][A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)?$/,k={valid:{fi:"Nimi on kelvollinen.",sv:"Namnet \xE4r giltigt.",en:"The name is valid."},invalid:{fi:"Nimen tulee alkaa isolla kirjaimella ja olla muodossa 'Esimerkki' tai 'Esimerkki-Esimerkki'.",sv:"Namnet m\xE5ste b\xF6rja med en stor bokstav och vara i formen 'Exempel' eller 'Exempel-Exempel'.",en:"The name must start with a capital letter and be in the form 'Example' or 'Example-Example'."}};var $=/^(?=.{1,254}$)(?=^[^@]{1,64}@)(?:[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+(?:\.[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+)*)@(?:[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?\.)+(?:[A-Za-z]{2,63}|xn--[A-Za-z0-9-]{2,59})$/,E={valid:{fi:"S\xE4hk\xF6postiosoite on kelvollinen.",sv:"E-postadressen \xE4r giltig.",en:"The email address is valid."},invalid:{fi:"S\xE4hk\xF6postiosoitteen on oltava muodossa 'user@example.com'.",sv:"E-postadressen m\xE5ste vara i formen 'user@example.com'.",en:"The email address must be in the form 'user@example.com'."}};function C(i,e="en"){let{id:t,value:n,successMessage:s,errorMessage:o}=i;if(typeof n!="string")throw new TypeError("Email address must be a string");let a=n.trim(),l=$.test(a);return{id:t,status:l,message:l?s||E.valid[e]:o||E.invalid[e]}}r(C,"validateEmailAddress");var M=/^\+[1-9]\d{2}\d{9}$/,f={valid:{fi:"Puhelinnumero on kelvollinen.",sv:"Telefonnumret \xE4r giltigt.",en:"The phone number is valid."},invalid:{fi:"Puhelinnumeron on oltava muodossa '+123123456789' (kolme numeroa maatunnus ja yhdeks\xE4n numeroa).",sv:"Telefonnumret m\xE5ste vara i formen '+123123456789' (tre siffror landskod och nio siffror).",en:"The phone number must be in the format '+123123456789' (three-digit country code and nine digits)."}};function I(i,e="en"){let{id:t,value:n,successMessage:s,errorMessage:o}=i;if(typeof n!="string")throw new TypeError("Phone number must be a string");if(n.length!==13||n.charCodeAt(0)!==43)return{id:t,status:!1,message:o||f.invalid[e]};let a=M.test(n);return{id:t,status:a,message:a?s||f.valid[e]:o||f.invalid[e]}}r(I,"validatePhoneNumber");var y={valid:{fi:"Valintaruutu on valittu.",sv:"Kryssrutan \xE4r markerad.",en:"The checkbox is checked."},invalid:{fi:"T\xE4m\xE4 valintaruutu on pakollinen ja sen on oltava valittuna.",sv:"Den h\xE4r kryssrutan \xE4r obligatorisk och m\xE5ste vara markerad.",en:"This checkbox is required and must be checked."}};function N(i,e="en"){let{id:t,required:n,value:s,successMessage:o,errorMessage:a}=i;if(typeof s!="boolean")throw new TypeError("Checkbox value must be a boolean");let l=!0;return n===!0&&s===!1&&(l=!1),{id:t,status:l,message:l?o||y.valid[e]:a||y.invalid[e]}}r(N,"validateCheckboxInput");function D(i,e={}){let{trim:t=!0,collapseWhitespace:n=!0,stripControls:s=!0,maxLen:o=4096}=e,a=String(i??"");return t&&(a=a.trim()),s&&(a=a.replace(/[\u0000-\u001F\u007F]/g,"")),n&&(a=a.replace(/\s+/g," ")),o&&a.length>o&&(a=a.slice(0,o)),a}r(D,"sanitizeString");function j(i){return String(i??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}r(j,"escapeHTML");var L={properName:F,emailAddress:C,phoneNumber:I,checkboxInput:N,string:D,html:j};async function b(i,e="en"){if(!Array.isArray(i))throw new TypeError("fields must be an array of rule objects");let t=[];for(let n of i){let s=L[n.type],o=s(n,e);t.push({id:o.id,status:o.status,message:o.message})}return t}r(b,"validate");async function x(i,e){return b([{id:"firstname",type:"properName",required:!0,value:i.firstname,errorMessage:{fi:"Etunimi on pakollinen",sv:"F\xF6rnamn kr\xE4vs",en:"First name is required"}[e]},{id:"lastname",type:"properName",required:!0,value:i.lastname,errorMessage:{fi:"Sukunimi on pakollinen",sv:"Efternamn kr\xE4vs",en:"Last name is required"}[e]},{id:"email",type:"emailAddress",required:!0,value:i.email,errorMessage:{fi:"S\xE4hk\xF6posti on pakollinen",sv:"E-post kr\xE4vs",en:"Email is required"}[e]},{id:"terms-acceptance",type:"checkboxInput",required:!0,value:i.termsAcceptance,errorMessage:{fi:"Hyv\xE4ksy ehdot",sv:"Acceptera villkoren",en:"Accept terms"}[e]},{id:"contact-permission",type:"checkboxInput",required:!0,value:i.contactPermission,errorMessage:{fi:"Yhteydenotto\u2011lupa on pakollinen",sv:"Kontakt\u2011tillst\xE5nd kr\xE4vs",en:"Contact permission is required"}[e]}],e)}r(x,"validateSignUpForm");function w(i,e,t){return new Promise(async n=>{let s=document.createElement("dialog");s.innerHTML=`<div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Pieni hetki",sv:"En liten stund",en:"Just a second"}[e]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`,document.body.appendChild(s),s.show();let o=JSON.stringify(i);try{t.disabled=!0;let a=await fetch("/authn/sign_up",{method:"post",headers:{"content-type":"application/json",action:"initialize"},body:o});if(a.status===202){let l=`<strong>${i.email}</strong>`;s.innerHTML=`<h2>${{fi:"Vahvista s\xE4hk\xF6postiosoitteesi",sv:"Bekr\xE4fta din e-postadress",en:"Confirm your email address"}[e]}</h2><div class="row transparent" id="code-input"><input class="digit" type="text" inputmode="numeric" autocomplete="one-time-code" pattern="\\d" maxlength="8"></div><p>${{fi:`Sy\xF6t\xE4 8-numeroinen koodi, jonka l\xE4hetimme osoitteeseen "${l}" osoitteesta "DoNotReply@mail.vorte.app"`,sv:`Ange den 8-siffriga koden som vi skickade till "${l}" fr\xE5n adressen "DoNotReply@mail.vorte.app"`,en:`Enter the 8-digit code we sent to "${l}" from "DoNotReply@mail.vorte.app"`}[e]}</p><button id="send-confirmation" class="action" title="${{fi:"L\xE4het\xE4 koodi palvelimelle tarkistettavaksi ja kirjaudu sis\xE4\xE4n",sv:"Skicka koden till servern f\xF6r kontroll och logga in",en:"Send the code to the server for verification and sign in"}[e]}" > ${{fi:"vahvista k\xE4ytt\xE4j\xE4",sv:"bekr\xE4fta anv\xE4ndare",en:"verify account"}[e]} </button><a hreflang="${e}" id="sign_up" href="${{fi:"/fi/luo-k\xE4ytt\xE4j\xE4tili",sv:"/sv/skapa-konto",en:"/en/create-an-account"}[e]}" title="${{fi:"Yrit\xE4 l\xE4hett\xE4\xE4 lomake uudelleen",sv:"F\xF6rs\xF6k skicka formul\xE4ret igen",en:"Try resubmitting the form"}[e]}"><h5> ${{fi:"Etk\xF6 saanut s\xE4hk\xF6postia? L\xE4het\xE4 lomake uudelleen.",sv:"Fick du inte e-post? Skicka formul\xE4ret igen.",en:"Didn't receive the email? Resubmit the form."}[e]} </h5></a>`,n()}else throw new Error(a)}catch(a){s.textContent={fi:'Jokin meni pieleen. Jos ongelma jatkuu, ota yhteys Vorten tukeen. "support@vorte.app"',sv:'N\xE5got gick fel. Kontakta Vortes support om problemet kvarst\xE5r. "support@vorte.app"',en:'Something went wrong. If the problem persists, please contact Vorte support. "support@vorte.app"'}[e],t.disabled=!1,console.log(a)}})}r(w,"initDialog");async function A(i=100,e=5e3){let t=performance.now(),n;do{if(n=globalThis.turnstile,n)return n;if(performance.now()-t>e)throw new Error("Turnstile ei latautunut ajoissa");await new Promise(s=>setTimeout(s,i))}while(!n)}r(A,"waitForTurnstile");async function S(){let i=document.body.querySelectorAll("button");i.forEach(t=>{t.disabled=!0}),await A();let e;if(e=turnstile.render("#turnstile-container",{sitekey:"0x4AAAAAABfpGcyoBCK_N8CO",theme:document.documentElement.getAttribute("data-theme"),size:"flexible",callback(){i.forEach(t=>{t.disabled=!1})},"expired-callback"(){e&&turnstile.reset(e),i.forEach(t=>{t.disabled=!0})}}),document.documentElement.getAttribute("data-view")==="sign_up"){let t=document.documentElement.lang||"en",n=document.getElementById("sign-up-btn");if(!n)return;n.addEventListener("click",async s=>{s.preventDefault();let o="";typeof turnstile<"u"&&e&&(o=turnstile.getResponse(e));let a={turnstileToken:o,firstname:document.getElementById("firstname").value,lastname:document.getElementById("lastname").value,email:document.getElementById("email").value,termsAcceptance:document.getElementById("terms-acceptance").checked,contactPermission:document.getElementById("contact-permission").checked,newsletterSubscription:document.getElementById("newsletter-subscription").checked};["firstname","lastname","email","terms-acceptance","contact-permission"].forEach(c=>{let d=document.getElementById(`${c}-feedback`);d&&(d.textContent="")});let l=await x(a,t),h=!0;for(let{id:c,status:d,message:u}of l)if(!d){let m=document.getElementById(`${c}-feedback`);m&&(m.textContent=u),h=!1}if(!h)return;await w(a,t,n),document.getElementById("send-confirmation").addEventListener("click",async()=>{let c=JSON.stringify({code:document.querySelector("input.digit").value,form:a});try{let d=document.body.querySelector("dialog");d.innerHTML=` <div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Luodaan tili\xE4",sv:"Skapar ditt konto",en:"Creating your account"}[t]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;let u=await fetch("/authn/sign_up",{method:"post",headers:{"content-type":"application/json",action:"callback"},body:c}),m=await u.text();console.log(m),console.log(u.status);let p=new Set([201,409,400]).has(u.status)?u.status:400;p===201&&(cookies.HAS_ACCOUNT="true"),await new Promise(v=>{document.getElementById("loader-text").textContent={201:{fi:"Tilin luonti onnistui!",sv:"Kontot har skapats!",en:"Account created successfully!"},409:{fi:"T\xE4ll\xE4 s\xE4hk\xF6postiosoitteella on jo tili",sv:"Det finns redan ett konto med den h\xE4r e-postadressen",en:"An account with this email address already exists"},400:{fi:"Antamasi koodi oli v\xE4\xE4rin tai vanhentunut",sv:"Koden du angav var felaktig eller har g\xE5tt ut",en:"The code you entered was incorrect or has expired"}}[p][t];let g=document.getElementById("loader-animation");g.classList.add("ready"),g.classList.add({201:"success",409:"error",400:"error"}[p]),d.insertAdjacentHTML("beforeend",{201:`<a class="action" id="install" hreflang="${t}" href="https://why.vorte.app${{fi:"/fi/asenna",sv:"/sv/installera",en:"/en/install"}[t]}" >${{fi:" lis\xE4\xE4 laitteesi aloitusn\xE4yt\xF6lle",sv:" l\xE4gg till p\xE5 din enhets startsk\xE4rm",en:" add to your device's home screen"}[t]}</a><a class="action" id="dashboard" href="https://vorte.app${{fi:"/fi/ohjauspaneeli",sv:"/sv/instrumentpanel",en:"/en/dashboard"}[t]}" hreflang="${t}"> ${{fi:" k\xE4yt\xE4n mielummin selaimessa",sv:" jag f\xF6redrar att anv\xE4nda webbl\xE4saren",en:" I prefer to use it in the browser"}[t]} </a>`,409:`<a class="action" id="sign_in" href="${{fi:"/fi/kirjautuminen",sv:"/sv/inloggning",en:"/en/login"}[t]}" hreflang="${t}"> ${{fi:" siirry kirjautumiseen",sv:" g\xE5 till inloggning",en:" go to login"}[t]} </a>`,400:`<a class="action" id="sign_up" href="${{fi:"/fi/luo-k\xE4ytt\xE4j\xE4tili",sv:"/sv/skapa-konto",en:"/en/create-an-account"}[t]}" hreflang="${t}"> ${{fi:" yrit\xE4 uudelleen",sv:" f\xF6rs\xF6k igen",en:" try again"}[t]} </a>`}[p]),v()}),document.getElementById("install").addEventListener("click",v=>{v.preventDefault(),window.pwaInstall.prompt(t)})}catch(d){console.error(d)}})})}}r(S,"handleEvents");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",S):S();export{S as handleEvents};
