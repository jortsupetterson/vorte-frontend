import{a as r}from"../../chunk-EI7MMDWY.js";function S(n,t="en"){let{id:e,value:i,successMessage:s,errorMessage:o}=n;if(typeof i!="string")throw new TypeError("Name must be a string");let a=i.normalize("NFC").trim(),l=T.test(a);return{id:e,status:l,message:l?s||g.valid[t]:o||g.invalid[t]}}r(S,"validateProperName");var T=/^(?=.{1,64}$)(?:[A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)(?:[-\u2010\u2011'â€™][A-Z\u00C0-\u00D6\u00D8-\u00DE\u1E00-\u1EFF][A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u1E00-\u1EFF]*)?$/,g={valid:{fi:"Nimi on kelvollinen.",sv:"Namnet \xE4r giltigt.",en:"The name is valid."},invalid:{fi:"Nimen tulee alkaa isolla kirjaimella ja olla muodossa 'Esimerkki' tai 'Esimerkki-Esimerkki'.",sv:"Namnet m\xE5ste b\xF6rja med en stor bokstav och vara i formen 'Exempel' eller 'Exempel-Exempel'.",en:"The name must start with a capital letter and be in the form 'Example' or 'Example-Example'."}};var F=/^(?=.{1,254}$)(?=^[^@]{1,64}@)(?:[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+(?:\.[A-Za-z0-9\u00C0-\u024F\u1E00-\u1EFF_%+'-]+)*)@(?:[A-Za-z0-9](?:[A-Za-z0-9-]{0,61}[A-Za-z0-9])?\.)+(?:[A-Za-z]{2,63}|xn--[A-Za-z0-9-]{2,59})$/,E={valid:{fi:"S\xE4hk\xF6postiosoite on kelvollinen.",sv:"E-postadressen \xE4r giltig.",en:"The email address is valid."},invalid:{fi:"S\xE4hk\xF6postiosoitteen on oltava muodossa 'user@example.com'.",sv:"E-postadressen m\xE5ste vara i formen 'user@example.com'.",en:"The email address must be in the form 'user@example.com'."}};function $(n,t="en"){let{id:e,value:i,successMessage:s,errorMessage:o}=n;if(typeof i!="string")throw new TypeError("Email address must be a string");let a=i.trim(),l=F.test(a);return{id:e,status:l,message:l?s||E.valid[t]:o||E.invalid[t]}}r($,"validateEmailAddress");var M=/^\+[1-9]\d{2}\d{9}$/,p={valid:{fi:"Puhelinnumero on kelvollinen.",sv:"Telefonnumret \xE4r giltigt.",en:"The phone number is valid."},invalid:{fi:"Puhelinnumeron on oltava muodossa '+123123456789' (kolme numeroa maatunnus ja yhdeks\xE4n numeroa).",sv:"Telefonnumret m\xE5ste vara i formen '+123123456789' (tre siffror landskod och nio siffror).",en:"The phone number must be in the format '+123123456789' (three-digit country code and nine digits)."}};function I(n,t="en"){let{id:e,value:i,successMessage:s,errorMessage:o}=n;if(typeof i!="string")throw new TypeError("Phone number must be a string");if(i.length!==13||i.charCodeAt(0)!==43)return{id:e,status:!1,message:o||p.invalid[t]};let a=M.test(i);return{id:e,status:a,message:a?s||p.valid[t]:o||p.invalid[t]}}r(I,"validatePhoneNumber");var k={valid:{fi:"Valintaruutu on valittu.",sv:"Kryssrutan \xE4r markerad.",en:"The checkbox is checked."},invalid:{fi:"T\xE4m\xE4 valintaruutu on pakollinen ja sen on oltava valittuna.",sv:"Den h\xE4r kryssrutan \xE4r obligatorisk och m\xE5ste vara markerad.",en:"This checkbox is required and must be checked."}};function N(n,t="en"){let{id:e,required:i,value:s,successMessage:o,errorMessage:a}=n;if(typeof s!="boolean")throw new TypeError("Checkbox value must be a boolean");let l=!0;return i===!0&&s===!1&&(l=!1),{id:e,status:l,message:l?o||k.valid[t]:a||k.invalid[t]}}r(N,"validateCheckboxInput");function C(n,t={}){let{trim:e=!0,collapseWhitespace:i=!0,stripControls:s=!0,maxLen:o=4096}=t,a=String(n??"");return e&&(a=a.trim()),s&&(a=a.replace(/[\u0000-\u001F\u007F]/g,"")),i&&(a=a.replace(/\s+/g," ")),o&&a.length>o&&(a=a.slice(0,o)),a}r(C,"sanitizeString");function D(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}r(D,"escapeHTML");var j={properName:S,emailAddress:$,phoneNumber:I,checkboxInput:N,string:C,html:D};async function y(n,t="en"){if(!Array.isArray(n))throw new TypeError("fields must be an array of rule objects");let e=[];for(let i of n){let s=j[i.type],o=s(i,t);e.push({id:o.id,status:o.status,message:o.message})}return e}r(y,"validate");async function b(n,t){return y([{id:"firstname",type:"properName",required:!0,value:n.firstname,errorMessage:{fi:"Etunimi on pakollinen",sv:"F\xF6rnamn kr\xE4vs",en:"First name is required"}[t]},{id:"lastname",type:"properName",required:!0,value:n.lastname,errorMessage:{fi:"Sukunimi on pakollinen",sv:"Efternamn kr\xE4vs",en:"Last name is required"}[t]},{id:"email",type:"emailAddress",required:!0,value:n.email,errorMessage:{fi:"S\xE4hk\xF6posti on pakollinen",sv:"E-post kr\xE4vs",en:"Email is required"}[t]},{id:"terms-acceptance",type:"checkboxInput",required:!0,value:n.termsAcceptance,errorMessage:{fi:"Hyv\xE4ksy ehdot",sv:"Acceptera villkoren",en:"Accept terms"}[t]},{id:"contact-permission",type:"checkboxInput",required:!0,value:n.contactPermission,errorMessage:{fi:"Yhteydenotto\u2011lupa on pakollinen",sv:"Kontakt\u2011tillst\xE5nd kr\xE4vs",en:"Contact permission is required"}[t]}],t)}r(b,"validateSignUpForm");function x(n,t,e){return new Promise(async i=>{let s=document.createElement("dialog");s.innerHTML=`<div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Pieni hetki",sv:"En liten stund",en:"Just a second"}[t]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`,document.body.appendChild(s),s.show();let o=JSON.stringify(n);try{e.disabled=!0;let a=await fetch("/authn/sign_up",{method:"post",headers:{"content-type":"application/json",action:"initialize"},body:o});if(a.status===202){let l=`<strong>${n.email}</strong>`;s.innerHTML=`<h2>${{fi:"Vahvista s\xE4hk\xF6postiosoitteesi",sv:"Bekr\xE4fta din e-postadress",en:"Confirm your email address"}[t]}</h2><div class="row transparent" id="code-input"><input class="digit" type="text" inputmode="numeric" autocomplete="one-time-code" pattern="\\d" maxlength="8"></div><p>${{fi:`Sy\xF6t\xE4 8-numeroinen koodi, jonka l\xE4hetimme osoitteeseen "${l}" osoitteesta "DoNotReply@mail.vorte.app"`,sv:`Ange den 8-siffriga koden som vi skickade till "${l}" fr\xE5n adressen "DoNotReply@mail.vorte.app"`,en:`Enter the 8-digit code we sent to "${l}" from "DoNotReply@mail.vorte.app"`}[t]}</p><button id="send-confirmation" class="action" title="${{fi:"L\xE4het\xE4 koodi palvelimelle tarkistettavaksi ja kirjaudu sis\xE4\xE4n",sv:"Skicka koden till servern f\xF6r kontroll och logga in",en:"Send the code to the server for verification and sign in"}[t]}" > ${{fi:"vahvista k\xE4ytt\xE4j\xE4",sv:"bekr\xE4fta anv\xE4ndare",en:"verify account"}[t]} </button>`,i()}else throw new Error(a)}catch(a){s.textContent={fi:'Jokin meni pieleen. Jos ongelma jatkuu, ota yhteys Vorten tukeen. "support@vorte.app"',sv:'N\xE5got gick fel. Kontakta Vortes support om problemet kvarst\xE5r. "support@vorte.app"',en:'Something went wrong. If the problem persists, please contact Vorte support. "support@vorte.app"'}[t],e.disabled=!1,console.log(a)}})}r(x,"initDialog");async function w(n=100,t=5e3){let e=performance.now(),i;do{if(i=globalThis.turnstile,i)return i;if(performance.now()-e>t)throw new Error("Turnstile ei latautunut ajoissa");await new Promise(s=>setTimeout(s,n))}while(!i)}r(w,"waitForTurnstile");async function A(){let n=document.body.querySelectorAll("button");n.forEach(e=>{e.disabled=!0}),await w();let t;if(t=turnstile.render("#turnstile-container",{sitekey:"0x4AAAAAABfpGcyoBCK_N8CO",theme:document.documentElement.getAttribute("data-theme"),size:"flexible",callback(){n.forEach(e=>{e.disabled=!1})},"expired-callback"(){t&&turnstile.reset(t),n.forEach(e=>{e.disabled=!0})}}),document.documentElement.getAttribute("data-view")==="sign_up"){let e=document.documentElement.lang||"en",i=document.getElementById("sign-up-btn");if(!i)return;i.addEventListener("click",async s=>{s.preventDefault();let o="";typeof turnstile<"u"&&t&&(o=turnstile.getResponse(t));let a={turnstileToken:o,firstname:document.getElementById("firstname").value,lastname:document.getElementById("lastname").value,email:document.getElementById("email").value,termsAcceptance:document.getElementById("terms-acceptance").checked,contactPermission:document.getElementById("contact-permission").checked,newsletterSubscription:document.getElementById("newsletter-subscription").checked};["firstname","lastname","email","terms-acceptance","contact-permission"].forEach(c=>{let d=document.getElementById(`${c}-feedback`);d&&(d.textContent="")});let l=await b(a,e),v=!0;for(let{id:c,status:d,message:f}of l)if(!d){let u=document.getElementById(`${c}-feedback`);u&&(u.textContent=f),v=!1}if(!v)return;await x(a,e,i),document.getElementById("send-confirmation").addEventListener("click",async()=>{let c=JSON.stringify({code:document.querySelector("input.digit").value,form:a});try{let d=document.body.querySelector("dialog");d.innerHTML=` <div class="loader-row"><div id="loader-text" aria-live="polite">${{fi:"Luodaan tili\xE4",sv:"Skapar ditt konto",en:"Creating your account"}[e]}</div><div id="loader-animation"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>`;let u=(await fetch("/authn/sign_up",{method:"post",headers:{"content-type":"application/json",action:"callback"},body:c})).status;u===201&&(cookies.HAS_ACCOUNT="true",document.cookie="HAS_SESSION=true; path=/; SameSite=Strict; secure; Max-Age=86400;"),await new Promise(m=>{document.getElementById("loader-text").textContent={201:{fi:"Tilin luonti onnistui!",sv:"Kontot har skapats!",en:"Account created successfully!"},409:{fi:"T\xE4ll\xE4 s\xE4hk\xF6postiosoitteella on jo tili",sv:"Det finns redan ett konto med den h\xE4r e-postadressen",en:"An account with this email address already exists"},400:{fi:"Antamasi koodi oli v\xE4\xE4rin tai vanhentunut",sv:"Koden du angav var felaktig eller har g\xE5tt ut",en:"The code you entered was incorrect or has expired"}}[u][e];let h=document.getElementById("loader-animation");h.classList.add("ready"),h.classList.add({201:"success",409:"error",400:"error"}[u]),d.insertAdjacentHTML("beforeend",{201:` <a class="action" id="install" hreflang="${e}" href="https://why.vorte.app${{fi:"/fi/asenna",sv:"/sv/installera",en:"/en/install"}[e]}" >${{fi:" lis\xE4\xE4 laitteesi aloitusn\xE4yt\xF6lle",sv:" l\xE4gg till p\xE5 din enhets startsk\xE4rm",en:" add to your device's home screen"}[e]}</a><a class="action" id="dashboard" href="https://vorte.app${{fi:"/fi/ohjauspaneeli",sv:"/sv/instrumentpanel",en:"/en/dashboard"}[e]}" hreflang="${e}"> ${{fi:" k\xE4yt\xE4n mielummin selaimessa",sv:" jag f\xF6redrar att anv\xE4nda webbl\xE4saren",en:" I prefer to use it in the browser"}[e]} </a>`,409:`<a class="action" id="sign_in" href="${{fi:"/fi/kirjautuminen",sv:"/sv/inloggning",en:"/en/login"}[e]}" hreflang="${e}"> ${{fi:" siirry kirjautumiseen",sv:" g\xE5 till inloggning",en:" go to login"}[e]} </a>`,400:`<a class="action" id="sign_up" href="${{fi:"/fi/luo-k\xE4ytt\xE4j\xE4tili",sv:"/sv/skapa-konto",en:"/en/create-an-account"}[e]}" hreflang="${e}"> ${{fi:" yrit\xE4 uudelleen",sv:" f\xF6rs\xF6k igen",en:" try again"}[e]} </a>`}[u]),m()}),document.getElementById("install").addEventListener("click",m=>{m.preventDefault(),window.pwaInstall.prompt(e)})}catch(d){console.error(d)}})})}}r(A,"handleEvents");document.readyState==="loading"?document.addEventListener("DOMContentLoaded",A):A();export{A as handleEvents};
